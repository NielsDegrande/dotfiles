#!/usr/bin/env bash

# Useful references:
# - https://macos-defaults.com/.
# - https://macowners.club/posts/sane-defaults-for-macos/

###############################################################################
# General                                                                     #
###############################################################################

# Expand save panel by default.
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode2 -bool true

###############################################################################
# Sound                                                                       #
###############################################################################

# Disable UI sound effects (default: true).
defaults write NSGlobalDomain com.apple.sound.uiaudio.enabled -int 0

# Disable feedback when volume is changed (default: true).
defaults write NSGlobalDomain com.apple.sound.beep.feedback -bool false

# Set alert sound volume to 0 (default: 0.5).
defaults write NSGlobalDomain com.apple.sound.beep.volume -float 0

# Disable startup chime (default: %00; requires reboot).
sudo nvram StartupMute=%01

###############################################################################
# Finder                                                                      #
###############################################################################

# Allow quitting via ⌘ + Q; doing so will also hide desktop icons.
# defaults write com.apple.finder QuitMenuItem -bool YES && killall Finder

# Disable tabs.
defaults write NSGlobalDomain NSWindowTabbingEnabled -bool false

# Always show suffixes.
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Always search current folder.
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# Set screenshot location to Downloads.
defaults write com.apple.screencapture location "$HOME/Downloads"

# Show path bar and status bar.
defaults write com.apple.finder "ShowStatusBar" -bool true
defaults write com.apple.finder "ShowPathbar" -bool true

# Set default view style to column.
defaults write com.apple.finder "FXPreferredViewStyle" -string "clmv"

# Items to display on the desktop.
defaults write com.apple.finder ShowHardDrivesOnDesktop -int 0
defaults write com.apple.finder ShowMountedServersOnDesktop -int 0
defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -int 0
defaults write com.apple.finder ShowRemovableMediaOnDesktop -int 0

# Show scroll bars when scrolling.
defaults write NSGlobalDomain AppleShowScrollBars -string "WhenScrolling"

# Show the ~/Library folder
chflags nohidden ~/Library


###############################################################################
# Dock                                                                        #
###############################################################################

# Remove everything.
# dockutil --remove all > /dev/null 2>&1
# dockutil --add ... > /dev/null 2>&1

# Set minimize animation effect to Scale.
defaults write com.apple.dock mineffect -string scale

# Minimize windows into the app's Dock icon (default: false).
defaults write com.apple.dock minimize-to-application -bool true

# Automatically hide the dock.
defaults write com.apple.dock autohide -bool true

# Make it popup faster.
defaults write com.apple.dock autohide-delay -float 0
defaults write com.apple.dock autohide-time-modifier -float 0

# Do not show recents.
defaults write com.apple.dock show-recents -bool false

# Disable trackpad "Show Desktop" spread gesture (default: true).
defaults write com.apple.dock showDesktopGestureEnabled -bool false

# Group windows by application in Exposé.
defaults write com.apple.dock expose-group-apps -bool true

# Do not rearrange spaces based on most recent use.
defaults write com.apple.dock mru-spaces -bool false

# Different spaces for different displays.
defaults write com.apple.spaces spans-displays -int 0


###############################################################################
# Control Center & Menu Bar                                                   #
###############################################################################

# Hide Wi-Fi from menu bar (default: true).
defaults write com.apple.controlcenter "NSStatusItem Visible WiFi" -bool false

# Hide Bluetooth from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible Bluetooth" -bool false

# Hide AirDrop from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible AirDrop" -bool false

# Hide Stage Manager from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible StageManager" -bool false

# Hide Display from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible Display" -bool false

# Hide Sound from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible Sound" -bool false

# Hide Now Playing from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible NowPlaying" -bool false

# Hide Spotlight from menu bar (default: true).
defaults write com.apple.controlcenter "NSStatusItem Visible Spotlight" -bool false

# Hide Siri from menu bar (default: true).
defaults write com.apple.controlcenter "NSStatusItem Visible Siri" -bool false

# Hide Time Machine from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible TimeMachine" -bool false

# Hide VPN from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible VPN" -bool false

# Hide Weather from menu bar (default: false).
defaults write com.apple.controlcenter "NSStatusItem Visible Weather" -bool false

# Show battery in menu bar (default: true on laptops).
defaults write com.apple.controlcenter "NSStatusItem Visible Battery" -bool true

# Show battery percentage in menu bar (default: false).
defaults write com.apple.controlcenter BatteryShowPercentage -bool true

# Hide Input menu from menu bar (default: false).
defaults write com.apple.TextInputMenu visible -bool false


###############################################################################
# Trackpad                                                                    #
###############################################################################

# Enable tap-to-click (default: false / 0).
defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
sudo defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1

# Enable secondary click via two-finger tap (default: true / 0).
defaults write com.apple.AppleMultitouchTrackpad TrackpadRightClick -bool true
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRightClick -bool true
defaults write com.apple.AppleMultitouchTrackpad TrackpadCornerSecondaryClick -int 0
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadCornerSecondaryClick -int 0
defaults -currentHost write NSGlobalDomain com.apple.trackpad.enableSecondaryClick -bool true

# Enable "Look up" via three-finger tap (default: 0).
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerTapGesture -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerTapGesture -int 2
defaults -currentHost write NSGlobalDomain com.apple.trackpad.threeFingerTapGesture -int 2

# Swipe between full-screen apps with four fingers, not three (default: 0 / 2).
defaults write com.apple.AppleMultitouchTrackpad TrackpadFourFingerHorizSwipeGesture -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadFourFingerHorizSwipeGesture -int 2
defaults -currentHost write NSGlobalDomain com.apple.trackpad.fourFingerHorizSwipeGesture -int 2
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerHorizSwipeGesture -int 0
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerHorizSwipeGesture -int 0
defaults -currentHost write NSGlobalDomain com.apple.trackpad.threeFingerHorizSwipeGesture -int 0

# Mission Control / App Exposé with four-finger vertical swipes, not three (default: 0 / 2).
defaults write com.apple.AppleMultitouchTrackpad TrackpadFourFingerVertSwipeGesture -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadFourFingerVertSwipeGesture -int 2
defaults -currentHost write NSGlobalDomain com.apple.trackpad.fourFingerVertSwipeGesture -int 2
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerVertSwipeGesture -int 0
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerVertSwipeGesture -int 0
defaults -currentHost write NSGlobalDomain com.apple.trackpad.threeFingerVertSwipeGesture -int 0

# Enable rotate gesture (default: 0).
defaults write com.apple.AppleMultitouchTrackpad TrackpadRotate -int 1
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRotate -int 1

# Enable pinch to open Launchpad (default: 2).
defaults write com.apple.AppleMultitouchTrackpad TrackpadFourFingerPinchGesture -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadFourFingerPinchGesture -int 2
defaults write com.apple.AppleMultitouchTrackpad TrackpadFiveFingerPinchGesture -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadFiveFingerPinchGesture -int 2


###############################################################################
# Desktop & Stage Manager                                                     #
###############################################################################

# Disable Stage Manager (default: false).
defaults write com.apple.WindowManager GloballyEnabled -bool false

# Click wallpaper reveals desktop only in Stage Manager (default: true).
defaults write com.apple.WindowManager EnableStandardClickToShowDesktop -bool false

# Show desktop items on Desktop (default: false).
defaults write com.apple.WindowManager StandardHideDesktopIcons -bool false

# Hide desktop items in Stage Manager (default: true).
defaults write com.apple.WindowManager HideDesktop -bool true

# Show widgets on Desktop (default: false).
defaults write com.apple.WindowManager StandardHideWidgets -bool false

# Show widgets in Stage Manager (default: false).
defaults write com.apple.WindowManager StageManagerHideWidgets -bool false


###############################################################################
# Hot Corners                                                                 #
###############################################################################

# Disable all hot corners (default: varies).
# Values: 0 = no action, 2 = Mission Control, 3 = App Windows,
#   4 = Desktop, 5 = Start Screen Saver, 6 = Disable Screen Saver,
#   10 = Put Display to Sleep, 11 = Launchpad, 13 = Lock Screen.
defaults write com.apple.dock wvous-tl-corner -int 0
defaults write com.apple.dock wvous-tl-modifier -int 0
defaults write com.apple.dock wvous-tr-corner -int 0
defaults write com.apple.dock wvous-tr-modifier -int 0
defaults write com.apple.dock wvous-bl-corner -int 0
defaults write com.apple.dock wvous-bl-modifier -int 0
defaults write com.apple.dock wvous-br-corner -int 0
defaults write com.apple.dock wvous-br-modifier -int 0


###############################################################################
# Privacy                                                                     #
###############################################################################

# Disable "Help Apple Improve Search" data sharing (default: 1).
defaults write com.apple.assistant.support "Search Queries Data Sharing Status" -int 2

# Disable "Improve Siri & Dictation" data sharing (default: 1).
defaults write com.apple.assistant.support "Siri Data Sharing Opt-In Status" -int 2


###############################################################################
# Apply Changes                                                               #
###############################################################################

echo "Restarting affected processes..."

# Restart UI processes to apply changes.
killall Finder 2>/dev/null || true
killall Dock 2>/dev/null || true

# Wait briefly before restarting remaining processes.
sleep 1

killall SystemUIServer 2>/dev/null || true
killall ControlCenter 2>/dev/null || true
killall TextInputMenuAgent 2>/dev/null || true
killall WindowManager 2>/dev/null || true

echo "Done. Some changes may require a logout or reboot to take effect."
